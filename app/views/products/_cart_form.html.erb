<% @cart = current_cart %>
<% unless @cart.products.include?(@product) %>
  <div id="cart_form">
    <%= form_for LineItem.new, :remote => true do |f| %>
      <div><%= f.hidden_field :product_id, :value => @product.id %></div>
      <div><%= f.hidden_field :cart_id, :value => @cart.id %></div>
      <div class="actions"><%= f.submit "Add to cart" %></div>
    <% end %>
  </div>
<% end %>
